<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      const request = window.indexedDB.open('MyTestDatabase', 3);

      request.onerror = (event) => {
        console.log('ðŸš€ ~ indexedDB.html ~ event:', event);
        // ä½¿ç”¨ request.errorCode æ¥åšç‚¹ä»€ä¹ˆï¼
      };
      request.onsuccess = (event) => {
        console.log('ðŸš€ ~ indexedDB.html ~ event:', event);
        // ä½¿ç”¨ request.result æ¥åšç‚¹ä»€ä¹ˆï¼
      };

      // è¯¥äº‹ä»¶ä»…åœ¨æœ€æ–°çš„æµè§ˆå™¨ä¸­å®žçŽ°
      request.onupgradeneeded = (event) => {
        const db = event.target.result;

        // åˆ›å»ºä¸€ä¸ªå¯¹è±¡å­˜å‚¨æ¥å­˜å‚¨æˆ‘ä»¬å®¢æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†â€œssnâ€ä½œä¸ºé”®è·¯å¾„
        // å› ä¸º ssn å¯ä»¥ä¿è¯æ˜¯ä¸é‡å¤çš„â€”â€”æˆ–è‡³å°‘åœ¨å¯åŠ¨é¡¹ç›®çš„ä¼šè®®ä¸Šæˆ‘ä»¬æ˜¯è¿™æ ·è¢«å‘ŠçŸ¥çš„ã€‚
        const objectStore = db.createObjectStore('customers', {keyPath: 'ssn'});

        // åˆ›å»ºä¸€ä¸ªç´¢å¼•ä»¥é€šè¿‡å§“åæ¥æœç´¢å®¢æˆ·ã€‚åå­—å¯èƒ½ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ unique ç´¢å¼•ã€‚
        objectStore.createIndex('name', 'name', {unique: false});

        // ä½¿ç”¨é‚®ç®±å»ºç«‹ç´¢å¼•ï¼Œæˆ‘ä»¬æƒ³ç¡®ä¿å®¢æˆ·çš„é‚®ç®±ä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ unique ç´¢å¼•ã€‚
        objectStore.createIndex('email', 'email', {unique: true});

        // ä½¿ç”¨äº‹åŠ¡çš„ oncomplete äº‹ä»¶ç¡®ä¿åœ¨æ’å…¥æ•°æ®å‰å¯¹è±¡å­˜å‚¨å·²ç»åˆ›å»ºå®Œæ¯•ã€‚
        objectStore.transaction.oncomplete = (event) => {
          // å°†æ•°æ®ä¿å­˜åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡å­˜å‚¨ä¸­ã€‚
          const customerObjectStore = db
            .transaction('customers', 'readwrite')
            .objectStore('customers');
          customerData.forEach((customer) => {
            customerObjectStore.add(customer);
          });
        };
      };
    </script>
  </body>
</html>
