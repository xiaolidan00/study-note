<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
  </head>
  <body>
    <button onclick="onAdd()">add Frame</button>
    <button onclick="onRender()">Render GIF</button>
    <script>
      var gif = new GIF({
        workers: 2, // ä½¿ç”¨2ä¸ªWeb Workerè¿›è¡Œå¹¶è¡Œå¤„ç†
        quality: 10, // GIFè´¨é‡ï¼Œæ•°å­—è¶Šå°å›¾åƒè´¨é‡è¶Šé«˜ï¼Œæ–‡ä»¶è¶Šå¤§
        width: 500, // è¾“å‡ºGIFçš„å®½åº¦
        height: 400, // è¾“å‡ºGIFçš„é«˜åº¦
        transparent: 'rgba(0,0,0,0)',
        workerScript: './gif.worker.js' // **é‡è¦ï¼šWeb Workerè„šæœ¬çš„æ­£ç¡®è·¯å¾„**
      });

      const canvas = document.createElement('canvas');
      canvas.width = 500;
      canvas.height = 400;
      const ctx = canvas.getContext('2d');
      // ctx.fillStyle = 'white';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.body.appendChild(canvas);

      const animate = () => {
        const len = Math.round(Math.random() * 10);
        for (let i = 0; i < len; i++) {
          ctx.beginPath();
          ctx.arc(
            Math.round(Math.random() * canvas.width),
            Math.round(Math.random() * canvas.height),
            Math.round(Math.random() * 100),
            0,
            Math.PI * 2
          );
          ctx.fillStyle = `rgb(${Math.round(Math.random() * 255)},${Math.round(
            Math.random() * 255
          )},${Math.round(Math.random() * 255)})`;
          ctx.fill();
        }
      };

      const onAdd = () => {
        animate();
        gif.addFrame(canvas, {delay: 1000, copy: true});
      };

      const onRender = () => {
        gif.on('progress', (ev) => {
          console.log('ğŸš€ ~ gif.html ~ onRender ~ ev:', ev);
        });
        gif.on('finished', function (blob) {
          // `blob` æ˜¯åŒ…å«ç”Ÿæˆçš„GIFæ•°æ®çš„Blobå¯¹è±¡
          const url = URL.createObjectURL(blob);

          const a = document.createElement('a');
          a.style = 'display: none';
          a.download = new Date().getTime() + '.gif';
          a.href = url;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });

        gif.render();
      };
    </script>
  </body>
</html>
